const wmo = {
    "0": {
      "day": {
        "description": "Sunny",
        "image": "http://openweathermap.org/img/wn/01d@2x.png"
      },
      "night": {
        "description": "Clear",
        "image": "http://openweathermap.org/img/wn/01n@2x.png"
      }
    },
    "1": {
      "day": {
        "description": "Mainly Sunny",
        "image": "http://openweathermap.org/img/wn/01d@2x.png"
      },
      "night": {
        "description": "Mainly Clear",
        "image": "http://openweathermap.org/img/wn/01n@2x.png"
      }
    },
    "2": {
      "day": {
        "description": "Partly Cloudy",
        "image": "http://openweathermap.org/img/wn/02d@2x.png"
      },
      "night": {
        "description": "Partly Cloudy",
        "image": "http://openweathermap.org/img/wn/02n@2x.png"
      }
    },
    "3": {
      "day": {
        "description": "Cloudy",
        "image": "http://openweathermap.org/img/wn/03d@2x.png"
      },
      "night": {
        "description": "Cloudy",
        "image": "http://openweathermap.org/img/wn/03n@2x.png"
      }
    },
    "45": {
      "day": {
        "description": "Foggy",
        "image": "http://openweathermap.org/img/wn/50d@2x.png"
      },
      "night": {
        "description": "Foggy",
        "image": "http://openweathermap.org/img/wn/50n@2x.png"
      }
    },
    "48": {
      "day": {
        "description": "Rime Fog",
        "image": "http://openweathermap.org/img/wn/50d@2x.png"
      },
      "night": {
        "description": "Rime Fog",
        "image": "http://openweathermap.org/img/wn/50n@2x.png"
      }
    },
    "51": {
      "day": {
        "description": "Light Drizzle",
        "image": "http://openweathermap.org/img/wn/09d@2x.png"
      },
      "night": {
        "description": "Light Drizzle",
        "image": "http://openweathermap.org/img/wn/09n@2x.png"
      }
    },
    "53": {
      "day": {
        "description": "Drizzle",
        "image": "http://openweathermap.org/img/wn/09d@2x.png"
      },
      "night": {
        "description": "Drizzle",
        "image": "http://openweathermap.org/img/wn/09n@2x.png"
      }
    },
    "55": {
      "day": {
        "description": "Heavy Drizzle",
        "image": "http://openweathermap.org/img/wn/09d@2x.png"
      },
      "night": {
        "description": "Heavy Drizzle",
        "image": "http://openweathermap.org/img/wn/09n@2x.png"
      }
    },
    "56": {
      "day": {
        "description": "Light Freezing Drizzle",
        "image": "http://openweathermap.org/img/wn/09d@2x.png"
      },
      "night": {
        "description": "Light Freezing Drizzle",
        "image": "http://openweathermap.org/img/wn/09n@2x.png"
      }
    },
    "57": {
      "day": {
        "description": "Freezing Drizzle",
        "image": "http://openweathermap.org/img/wn/09d@2x.png"
      },
      "night": {
        "description": "Freezing Drizzle",
        "image": "http://openweathermap.org/img/wn/09n@2x.png"
      }
    },
    "61": {
      "day": {
        "description": "Light Rain",
        "image": "http://openweathermap.org/img/wn/10d@2x.png"
      },
      "night": {
        "description": "Light Rain",
        "image": "http://openweathermap.org/img/wn/10n@2x.png"
      }
    },
    "63": {
      "day": {
        "description": "Rain",
        "image": "http://openweathermap.org/img/wn/10d@2x.png"
      },
      "night": {
        "description": "Rain",
        "image": "http://openweathermap.org/img/wn/10n@2x.png"
      }
    },
    "65": {
      "day": {
        "description": "Heavy Rain",
        "image": "http://openweathermap.org/img/wn/10d@2x.png"
      },
      "night": {
        "description": "Heavy Rain",
        "image": "http://openweathermap.org/img/wn/10n@2x.png"
      }
    },
    "66": {
      "day": {
        "description": "Light Freezing Rain",
        "image": "http://openweathermap.org/img/wn/10d@2x.png"
      },
      "night": {
        "description": "Light Freezing Rain",
        "image": "http://openweathermap.org/img/wn/10n@2x.png"
      }
    },
    "67": {
      "day": {
        "description": "Freezing Rain",
        "image": "http://openweathermap.org/img/wn/10d@2x.png"
      },
      "night": {
        "description": "Freezing Rain",
        "image": "http://openweathermap.org/img/wn/10n@2x.png"
      }
    },
    "71": {
      "day": {
        "description": "Light Snow",
        "image": "http://openweathermap.org/img/wn/13d@2x.png"
      },
      "night": {
        "description": "Light Snow",
        "image": "http://openweathermap.org/img/wn/13n@2x.png"
      }
    },
    "73": {
      "day": {
        "description": "Snow",
        "image": "http://openweathermap.org/img/wn/13d@2x.png"
      },
      "night": {
        "description": "Snow",
        "image": "http://openweathermap.org/img/wn/13n@2x.png"
      }
    },
    "75": {
      "day": {
        "description": "Heavy Snow",
        "image": "http://openweathermap.org/img/wn/13d@2x.png"
      },
      "night": {
        "description": "Heavy Snow",
        "image": "http://openweathermap.org/img/wn/13n@2x.png"
      }
    },
    "77": {
      "day": {
        "description": "Snow Grains",
        "image": "http://openweathermap.org/img/wn/13d@2x.png"
      },
      "night": {
        "description": "Snow Grains",
        "image": "http://openweathermap.org/img/wn/13n@2x.png"
      }
    },
    "80": {
      "day": {
        "description": "Light Showers",
        "image": "http://openweathermap.org/img/wn/09d@2x.png"
      },
      "night": {
        "description": "Light Showers",
        "image": "http://openweathermap.org/img/wn/09n@2x.png"
      }
    },
    "81": {
      "day": {
        "description": "Showers",
        "image": "http://openweathermap.org/img/wn/09d@2x.png"
      },
      "night": {
        "description": "Showers",
        "image": "http://openweathermap.org/img/wn/09n@2x.png"
      }
    },
    "82": {
      "day": {
        "description": "Heavy Showers",
        "image": "http://openweathermap.org/img/wn/09d@2x.png"
      },
      "night": {
        "description": "Heavy Showers",
        "image": "http://openweathermap.org/img/wn/09n@2x.png"
      }
    },
    "85": {
      "day": {
        "description": "Light Snow Showers",
        "image": "http://openweathermap.org/img/wn/13d@2x.png"
      },
      "night": {
        "description": "Light Snow Showers",
        "image": "http://openweathermap.org/img/wn/13n@2x.png"
      }
    },
    "86": {
      "day": {
        "description": "Snow Showers",
        "image": "http://openweathermap.org/img/wn/13d@2x.png"
      },
      "night": {
        "description": "Snow Showers",
        "image": "http://openweathermap.org/img/wn/13n@2x.png"
      }
    },
    "95": {
      "day": {
        "description": "Thunderstorm",
        "image": "http://openweathermap.org/img/wn/11d@2x.png"
      },
      "night": {
        "description": "Thunderstorm",
        "image": "http://openweathermap.org/img/wn/11n@2x.png"
      }
    },
    "96": {
      "day": {
        "description": "Light Thunderstorms With Hail",
        "image": "http://openweathermap.org/img/wn/11d@2x.png"
      },
      "night": {
        "description": "Light Thunderstorms With Hail",
        "image": "http://openweathermap.org/img/wn/11n@2x.png"
      }
    },
    "99": {
      "day": {
        "description": "Thunderstorm With Hail",
        "image": "http://openweathermap.org/img/wn/11d@2x.png"
      },
      "night": {
        "description": "Thunderstorm With Hail",
        "image": "http://openweathermap.org/img/wn/11n@2x.png"
      }
    }
  }

// async function fetchDataAwal(kotaAwal) { //Fetch pertama kalinya
//     const date = new Date();
//     const dateFormatted = date.toDateString()
//     const responseOpenWeather = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${kotaAwal}&appid=${apiKey}`)
//     const responseOpenWeatherJson = await responseOpenWeather.json()
//         console.log(responseOpenWeatherJson, "<< response Open Weather Json")
    
//     let lat = responseOpenWeatherJson.coord.lat;
//     let lon = responseOpenWeatherJson.coord.lon;
    
//     const responseOpenMeteo = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min&timezone=Asia%2FBangkok`)
//     const responseOpenMeteoJson = await responseOpenMeteo.json()
//     console.log(responseOpenMeteoJson, "<< response Open Meteo Json")
//     if(responseOpenWeatherJson){
//         document.getElementById("place").innerHTML = responseOpenWeatherJson.name
//         document.getElementById("time").innerHTML = dateFormatted;
//     }
// }

// const kotaAwal = document.getElementById("place").innerHTML
// fetchDataAwal(kotaAwal)



const inputSearch = document.getElementById('input-search')
inputSearch.addEventListener("keypress", function(event) {
  // If the user presses the "Enter" key on the keyboard
  if (event.key === "Enter") {
    // Cancel the default action, if needed
    event.preventDefault();
    // Trigger the button element with a click
    document.getElementById("but-search").click();
  }
});

async function fetchData() {
  let searchCity = document.getElementById("input-search").value
  
  if(searchCity === ""){
    searchCity = "JAKARTA"
  }else{
    searchCity = searchCity.toUpperCase();
  }

  console.log(searchCity, "NAMA KOTAAA");

  // let searchCity = "jakarta"
  let date = new Date();
  date = date.toDateString()
  try {
    const responGeo = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${searchCity}`)
    const responGeoJson = await responGeo.json()
    console.log(responGeoJson, "GEOOO");
    if(!responGeoJson.results){
      throw  "Cek kembali nama kota"
    }else{
      const lat = responGeoJson.results[0].latitude;
      const lon = responGeoJson.results[0].longitude;
      const responseOpenMeteo = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,is_day,weather_code,wind_speed_10m&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FBangkok`)
      const responseOpenMeteoJson = await responseOpenMeteo.json()
      console.log(responseOpenMeteoJson, "<< response Open Meteo Json")
      // if (responseOpenMeteoJson.results) {
          const currentTem = responseOpenMeteoJson.current.temperature_2m
          const currentTemUnit = responseOpenMeteoJson.current_units.temperature_2m
          const curCode = responseOpenMeteoJson.current.weather_code.toString()
          const curDay = responseOpenMeteoJson.current.is_day
          const curHumidity = responseOpenMeteoJson.current.relative_humidity_2m
          const curHumidityUnit = responseOpenMeteoJson.current_units.relative_humidity_2m
          const windSpeed = responseOpenMeteoJson.current.wind_speed_10m
          const windSpeedUnit = responseOpenMeteoJson.current_units.wind_speed_10m
          let daily = responseOpenMeteoJson.daily
          let dailyUnits = responseOpenMeteoJson.daily_units
          let temMaxUnit = dailyUnits.temperature_2m_min
          let temMinUnit = dailyUnits.temperature_2m_min
          let curDesc;
          let curImg;
          if(curDay === 1){
            console.log("MASUK KESINI");
            curDesc =  wmo[curCode].day.description
            curImg = wmo[curCode].day.image
            document.body.style.backgroundImage = "url('https://i.pinimg.com/736x/08/1a/ed/081aed2e7ddc029f940021ddb22145fc.jpg')";
            document.body.style.color = "black";
            
            
          }else{
            console.log("MASUK KESANA")
            curImg = wmo[curCode].night.image
            curDesc = wmo[curCode].night.description
            document.body.style.backgroundImage = "url('https://i.pinimg.com/originals/71/32/d2/7132d24e46182c47ceca0c63470fea70.jpg')";
            // document.body.style = "background-repeat: none;background-size: none;"
            document.body.style.color = "white";
          }

          console.log("JALAN WOII");
          document.getElementById("curImg").src = curImg
          document.getElementById('curDesc').innerHTML = curDesc
          document.getElementById("deg").innerHTML = `<h1>${currentTem}</h1>`
          document.getElementById("deg").innerHTML += `<p>${currentTemUnit}</p>`
          document.getElementById("place").innerHTML = searchCity      
          document.getElementById("time").innerHTML = date    
          document.getElementById("cur-humidity").innerHTML = curHumidity  
          document.getElementById("cur-humidity-unit").innerHTML = curHumidityUnit  
          document.getElementById("wind-speed").innerHTML = windSpeed    
          document.getElementById("wind-speed-unit").innerHTML = windSpeedUnit   
          document.getElementById("cards").innerHTML = ""

          const weekday = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
          // let day = weekday[d.getDay()];
          console.log(daily);
          for (let i = 0; i < daily.time.length; i++) {
            let dailyTime = daily.time[i];
            let temMax = daily.temperature_2m_max[i]
            let temMin = daily.temperature_2m_min[i]

            let dailyWeatherCode = daily.weather_code[i]
            const dateObj = new Date(dailyTime)
            let day = weekday[dateObj.getUTCDay()]
            // console.log(day);
            document.getElementById("cards").innerHTML += `
            <div class="day">
              <p id="per-day">${day}</p>
              <img src="${wmo[dailyWeatherCode].day.image}">
              <div id="per-indicator">
                  <p>${temMax} <span>${temMaxUnit}</span></p>
                  <p>${temMin} <span>${temMinUnit}</span></p>
              </div>
        </div>`
            
          }

      // }
      
    }
  } catch (error) {
    console.log(error, "<<< ini error");
    document.getElementById("error").innerHTML = "ERROR"
    document.getElementById("error").style = "color:red"
  }
}



fetchData()